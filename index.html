<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plant Care Assistant - Smart Plant Care Guide</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="home-page">
    <!-- Auth Modal -->
    <div id="auth-overlay" class="auth-overlay" aria-hidden="true">
        <div class="auth-modal" role="dialog" aria-modal="true" aria-labelledby="auth-title">
            <div class="auth-header">
                <h2 id="auth-title">Welcome Back</h2>
                <p>Login or create an account to continue.</p>
            </div>
            <div class="auth-tabs" role="tablist">
                <button class="auth-tab active" type="button" data-auth-tab="login" role="tab" aria-selected="true">Login</button>
                <button class="auth-tab" type="button" data-auth-tab="register" role="tab" aria-selected="false">Register</button>
            </div>
            <form id="login-form" class="auth-form active" autocomplete="on">
                <div class="auth-field">
                    <label for="login-email">Email Address</label>
                    <input id="login-email" type="email" name="email" placeholder="you@example.com" required>
                </div>
                <div class="auth-field">
                    <label for="login-password">Password</label>
                    <input id="login-password" type="password" name="password" placeholder="Enter your password" required>
                </div>
                <div class="auth-actions">
                    <button class="btn btn-primary" type="submit">Login</button>
                </div>
            </form>
            <form id="register-form" class="auth-form" autocomplete="on">
                <div class="auth-field">
                    <label for="register-name">Full Name</label>
                    <input id="register-name" type="text" name="fullName" placeholder="Your full name" required>
                </div>
                <div class="auth-field">
                    <label for="register-email">Email Address</label>
                    <input id="register-email" type="email" name="email" placeholder="you@example.com" required>
                </div>
                <div class="auth-field">
                    <label for="register-password">Create Password</label>
                    <input id="register-password" type="password" name="password" placeholder="Create a password" required>
                </div>
                <div class="auth-actions">
                    <button class="btn btn-primary" type="submit">Create Account</button>
                </div>
            </form>
            <p id="auth-message" class="auth-message" role="status" aria-live="polite"></p>
        </div>
    </div>

    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <h1> Plant Care Assistant</h1>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link active">Home</a></li>
                <li><a href="plants.html" class="nav-link">Plants</a></li>
                <li><a href="weather.html" class="nav-link">Weather</a></li>
                <li><a href="#footer" class="nav-link">About</a></li>
            </ul>
            <div class="nav-actions">
                <button class="theme-toggle" id="theme-toggle" type="button" aria-pressed="false" aria-label="Toggle dark mode">
                    <span class="theme-icon" aria-hidden="true">ðŸ’¡</span>
                </button>
                <button class="profile-button" id="profile-toggle" type="button" aria-haspopup="true" aria-expanded="false">
                    <span class="profile-badge" id="profile-badge">P</span>
                    <span class="profile-text" id="profile-text">Welcome, Guest</span>
                    <span class="profile-caret">â–¾</span>
                </button>
                <div class="profile-menu" id="profile-menu" aria-hidden="true">
                    <div class="profile-header">
                        <div class="profile-avatar" id="profile-avatar">P</div>
                        <div class="profile-meta">
                            <p class="profile-name" id="profile-name">Guest</p>
                            <p class="profile-email" id="profile-email">Sign in to personalize</p>
                        </div>
                    </div>
                    <button class="btn btn-secondary profile-login-btn" id="profile-login-btn" type="button">Sign in</button>
                    <button class="btn btn-primary profile-logout-btn" id="profile-logout-btn" type="button">Logout</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container">
        <!-- Hero Section -->
        <section class="hero">
            <h2>Welcome to Plant Care Assistant</h2>
            <p>Discover plants perfect for your climate and get expert care tips tailored to your location</p>
        </section>

        <!-- Location Section -->
        <section class="card">
            <h3> Your Location</h3>
            <div id="location-info" class="location-info">
                <p class="loading">Detecting your location...</p>
            </div>
            <div id="location-map" class="location-map" aria-label="Map showing your location"></div>
        </section>

        <!-- Quick Stats -->
        <section class="stats-grid">
            <div class="stat-card">
                <h4> Weather</h4>
                <p><a href="weather.html">Check local weather</a></p>
            </div>
            <div class="stat-card">
                <h4> Plants</h4>
                <p><a href="plants.html">Browse country plants</a></p>
            </div>
            <div class="stat-card">
                <h4> Care Tips</h4>
                <p><a href="plants.html">Learn plant care</a></p>
            </div>
        </section>

        <!-- Features Section -->
        <section class="card features">
            <h3> Key Features</h3>
            <ul class="features-list">
                <li>âœ“ Auto-detect your country based on IP location</li>
                <li>âœ“ Real-time weather data for your region</li>
                <li>âœ“ Discover plants suitable for your climate</li>
                <li>âœ“ Get expert plant care advice</li>
                <li>âœ“ Learn common plant problems & solutions</li>
                <li>âœ“ Responsive design for all devices</li>
            </ul>
        </section>

        <!-- CTA Section -->
        <section class="card cta">
            <h3>Get Started Now!</h3>
            <p>Check the weather in your area and discover the perfect plants for your home.</p>
            <div class="cta-buttons">
                <a href="weather.html" class="btn btn-primary">View Weather â†’</a>
                <a href="plants.html" class="btn btn-secondary">Browse Plants â†’</a>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer" id="footer">
        <p><strong>Plant Care Assistant</strong> â€” smart, local plant guidance.</p>
        <p>Contact: support@plantcareassistant.com | +880 1XXX-XXXXXX</p>
        <p>&copy; 2024 Plant Care Assistant. All rights reserved.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/main.js"></script>
    <script>
        // Load location on home page
        document.addEventListener('DOMContentLoaded', function() {
            detectLocation();
        });

        let pendingMapCoords = null;

        async function detectLocation() {
            const locationInfo = document.getElementById('location-info');
            const mapContainer = document.getElementById('location-map');
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                
                locationInfo.innerHTML = `
                    <div class="location-card">
                        <p><strong>Country:</strong> ${data.country_name}</p>
                        <p><strong>City:</strong> ${data.city}</p>
                        <p><strong>Region:</strong> ${data.region}</p>
                        pendingMapCoords = { lat: data.latitude, lng: data.longitude };
                        renderLocationMap(data.latitude, data.longitude, mapContainer);
                    </div>
                `;

                renderLocationMap(data.latitude, data.longitude, mapContainer);
                
                // Store location in sessionStorage for other pages
                sessionStorage.setItem('userLocation', JSON.stringify({
                    country: data.country_name,
                    country_code: data.country_code,
                    city: data.city,
                    region: data.region,
                    latitude: data.latitude,
                    longitude: data.longitude
                }));
            } catch (error) {
                locationInfo.innerHTML = `
                    <div class="error">
                        <p> Could not detect location. Please enable location services or try again.</p>
                        <p class="error-details">${error.message}</p>
                    </div>
                `;
                console.error('Location detection error:', error);
            }
        }

        function renderLocationMap(lat, lng, container) {
            if (!container) return;
            if (!window.google || !window.google.maps) {
                pendingMapCoords = { lat, lng };
                container.innerHTML = '<p class="loading">Map is loading...</p>';
                return;
            }
            const map = new google.maps.Map(container, {
                center: { lat, lng },
                zoom: 10,
                disableDefaultUI: true,
                zoomControl: true,
                gestureHandling: 'cooperative'
            });
            new google.maps.Marker({
                position: { lat, lng },
                window.initMap = initMap;
                map,
                function renderStaticMap(lat, lng, container) {
                    if (!container) return;
                    const zoom = 12;
                    const size = '640x300';
                    const key = 'AIzaSyDZ4r9oIDutO1J88-e9cPZ-eVsQMvAlbvU';
                    const url = `https://maps.googleapis.com/maps/api/staticmap?center=${lat},${lng}&zoom=${zoom}&size=${size}&markers=color:green|${lat},${lng}&key=${key}`;
                    container.innerHTML = `<img src="${url}" alt="Map showing your location" />`;
                }
                title: 'Your Location'
                setTimeout(() => {
                    if (!window.google || !window.google.maps) {
                        const mapContainer = document.getElementById('location-map');
                        if (pendingMapCoords) {
                            renderStaticMap(pendingMapCoords.lat, pendingMapCoords.lng, mapContainer);
                        }
                    }
                }, 3000);
            });
        }

        function initMap() {
            if (!pendingMapCoords) return;
            const mapContainer = document.getElementById('location-map');
            renderLocationMap(pendingMapCoords.lat, pendingMapCoords.lng, mapContainer);
            pendingMapCoords = null;
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDZ4r9oIDutO1J88-e9cPZ-eVsQMvAlbvU&callback=initMap" async defer></script>
</body>
</html>
